# AI机械臂智能体项目移植指南

## 概述

本指南旨在帮助您将AI机械臂智能体项目移植到自己的机械臂上。由于不同品牌和型号的机械臂在控制方式、硬件接口等方面存在差异，您需要根据自己的机械臂进行相应的调整。

## 主要移植点分析

### 1. 机械臂控制库替换

当前项目使用了`pymycobot`库控制机械臂，您需要替换为自己机械臂的控制库。

#### 修改文件：utils_robot.py, utils_drag_teaching.py

```python
# 当前代码
from pymycobot.mycobot import MyCobot
from pymycobot import PI_PORT, PI_BAUD

# 修改为您的机械臂控制库
```

### 2. 机械臂参数调整

不同机械臂的关节数量、关节范围、运动速度等参数可能不同，需要进行相应的调整。

#### 修改文件：utils_robot.py

- **关节数量与范围**：
  ```python
  # 当前代码（6个关节）
  mc.send_angles([0, 0, 0, 0, 0, 0], 40)
  
  # 修改为您的机械臂关节数量和范围
  ```

- **运动速度**：
  ```python
  # 当前代码（速度为40）
  mc.send_angles([0, 0, 0, 0, 0, 0], 40)
  
  # 修改为您的机械臂合适的运动速度
  ```

### 3. 坐标系调整

不同机械臂的坐标系定义可能不同，需要重新校准。

#### 修改文件：utils_robot.py

- **坐标移动函数**：
  ```python
  # 当前代码
  def move_to_coords(X=150, Y=-130, HEIGHT_SAFE=230):
      print('移动至指定坐标：X {} Y {}'.format(X, Y))
      mc.send_coords([X, Y, HEIGHT_SAFE, 0, 180, 90], 20, 0)
      time.sleep(4)
  ```

- **手眼标定**：
  ```python
  # 当前代码（像素坐标到机械臂坐标的转换）
  def eye2hand(X_im=160, Y_im=120):
      # 整理两个标定点的坐标
      cali_1_im = [130, 290]                       # 左下角，第一个标定点的像素坐标，要手动填！
      cali_1_mc = [-21.8, -197.4]                  # 左下角，第一个标定点的机械臂坐标，要手动填！
      cali_2_im = [640, 0]                         # 右上角，第二个标定点的像素坐标
      cali_2_mc = [215, -59.1]                     # 右上角，第二个标定点的机械臂坐标，要手动填！
      # ...
  ```

### 4. 硬件接口调整

#### 4.1 吸泵控制

当前项目使用GPIO控制吸泵，您需要根据自己的硬件连接进行调整。

#### 修改文件：utils_pump.py, utils_robot.py

```python
# 当前代码（GPIO 20控制吸泵，GPIO 21控制泄气阀门）
GPIO.setmode(GPIO.BCM)
GPIO.setup(20, GPIO.OUT)
GPIO.setup(21, GPIO.OUT)
GPIO.output(20, 1)        # 关闭吸泵电磁阀
```

#### 4.2 LED灯控制

当前项目使用机械臂内置的LED灯，您需要根据自己的硬件连接进行调整。

#### 修改文件：utils_led.py

```python
# 当前代码
mc.set_color(rgb_tuple[0], rgb_tuple[1], rgb_tuple[2])

# 修改为您的LED灯控制方式
```

### 5. 摄像头与手眼标定

需要根据自己的摄像头位置和机械臂进行重新的手眼标定。

#### 修改文件：utils_robot.py, utils_vlm_move.py

- **摄像头拍摄位置**：
  ```python
  # 当前代码（移动至俯视姿态）
  def move_to_top_view():
      print('移动至俯视姿态')
      mc.send_angles([-62.13, 8.96, -87.71, -14.41, 2.54, -16.34], 10)
      time.sleep(3)
  ```

- **手眼标定流程**：
  ```python
  # 在utils_vlm_move.py中
  ## 第一步：完成手眼标定
  print('第一步：完成手眼标定')
  ```

### 6. 预设动作重新定义

当前项目定义了一些预设动作，如摇头、点头、跳舞等，您需要根据自己的机械臂重新定义这些动作。

#### 修改文件：utils_robot.py

```python
# 当前代码（摇头动作）
def head_shake():
    # 左右摆头
    mc.send_angles([0.87,(-50.44),47.28,0.35,(-0.43),(-0.26)],70)
    time.sleep(1)
    for count in range(2):
        mc.send_angle(5, 30, 80)
        time.sleep(0.5)
        mc.send_angle(5, -30,80)
        time.sleep(0.5)
    mc.send_angles([0, 0, 0, 0, 0, 0], 40)
    time.sleep(2)
```

### 7. API密钥替换

需要替换为自己的大模型API密钥。

#### 修改文件：API_KEY.py

```python
# 当前代码
# 通义千问QwenVL系列
Qwen_KEY = "f8144ffaff7c459791XXXXXXXXX"

# 零一万物大模型开放平台
YI_KEY = "f8144ffaff7c459791XXXXXXXXX"

# 百度智能云千帆ModelBuilder
QIANFAN_ACCESS_KEY = "ALTAKRELRxSXXXXXXXXXX"
QIANFAN_SECRET_KEY = "3737d9da82de4f2XXXXXXXXXX"

# 百度智能云千帆AppBuilder-SDK
APPBUILDER_TOKEN = "bce-v3/ALTAK-7jr20xkZl4cDmhbQKA4ml/f560e5dc3XXXXXXX059XXXXXXXXX"

# 修改为您的API密钥
```

### 8. 智能体函数定义调整

根据您的机械臂功能，可能需要调整智能体的函数定义。

#### 修改文件：utils_agent.py

```python
# 当前代码（内置函数列表）
AGENT_SYS_PROMPT = '''
你是我的机械臂助手，机械臂内置了一些函数，请你根据我的指令，以json形式输出要运行的对应函数和你给我的回复

【以下是所有内置函数介绍】
机械臂位置归零，所有关节回到原点：back_zero()
放松机械臂，所有关节都可以自由手动拖拽活动：relax_arms()
做出摇头动作：head_shake()
做出点头动作：head_nod()
做出跳舞动作：head_dance()
打开吸泵：pump_on()
关闭吸泵：pump_off()
移动到指定XY坐标，比如移动到X坐标150，Y坐标-120：move_to_coords(X=150, Y=-120)
指定关节旋转，比如关节1旋转到60度，总共有6个关节：single_joint_move(1, 60)
移动至俯视姿态：move_to_top_view()
拍一张俯视图：top_view_shot()
开启摄像头，在屏幕上实时显示摄像头拍摄的画面：check_camera()
LED灯改变颜色，比如：llm_led('帮我把LED灯的颜色改为贝加尔湖的颜色')
将一个物体移动到另一个物体的位置上，比如：vlm_move('帮我把红色方块放在小猪佩奇上')
拖动示教，我可以拽着机械臂运动，然后机械臂模仿复现出一样的动作：drag_teach()
图像内容理解, 我给你配备了摄像头, 你可以根据图像内容回复我的问题, 比如vlm_vqa("请你告诉我桌面上看到了几个方块")
休息等待，比如等待两秒：time.sleep(2)

# 修改为您的机械臂支持的函数
```

## 移植步骤

### 1. 替换机械臂控制库

首先，您需要替换机械臂的控制库，确保能够正常控制您的机械臂。

### 2. 调整机械臂参数

根据您的机械臂参数，调整关节数量、关节范围、运动速度等。

### 3. 重新进行手眼标定

1. 安装摄像头并调整位置
2. 确定至少两个标定点的像素坐标和机械臂坐标
3. 更新`eye2hand`函数中的标定参数

### 4. 测试基本功能

测试机械臂的基本功能，如归零、关节控制、坐标移动等。

### 5. 调整预设动作

根据您的机械臂，重新定义摇头、点头、跳舞等预设动作。

### 6. 测试多模态功能

测试语音识别、图像识别、机械臂运动等多模态功能的协同工作。

### 7. 优化与调试

根据测试结果，进行相应的优化与调试。

## 注意事项

1. **安全第一**：在进行机械臂测试时，确保周围环境安全，避免发生意外。

2. **逐步测试**：先测试单个功能，再测试组合功能，确保每个功能都能正常工作。

3. **备份代码**：在修改代码前，建议先备份原代码，以便在出现问题时恢复。

4. **参考文档**：仔细阅读您的机械臂和相关硬件的官方文档，了解其控制方式和接口定义。

5. **调整参数**：根据实际情况，适当调整机械臂的运动速度、加速度等参数，确保运动平稳。

## 常见问题与解决方案

### 1. 机械臂无法连接

- **检查**：控制库是否正确安装，连接参数是否正确。
- **解决方案**：重新安装控制库，检查连接参数。

### 2. 运动轨迹不准确

- **检查**：手眼标定是否正确，坐标系是否一致。
- **解决方案**：重新进行手眼标定，调整坐标系。

### 3. 多模态功能无法正常工作

- **检查**：API密钥是否正确，网络连接是否正常。
- **解决方案**：更新API密钥，检查网络连接。

### 4. 硬件接口不匹配

- **检查**：GPIO接口定义是否正确，硬件连接是否牢固。
- **解决方案**：调整GPIO接口定义，检查硬件连接。

## 总结

将AI机械臂智能体项目移植到自己的机械臂上需要进行多个方面的调整，包括机械臂控制库、参数调整、坐标系、硬件接口、手眼标定等。通过本指南，您应该能够了解主要的移植点和调整方法。如果您在移植过程中遇到问题，建议参考相关硬件的官方文档或寻求技术支持。